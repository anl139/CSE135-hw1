<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Echo Form Demo</title>
<style>
body { font-family: sans-serif; margin: 2em; }
label { display: block; margin-top: 1em; }
button { margin-top: 1em; }
#responseContainer { margin-top: 2em; padding: 1em; border: 1px solid #ccc; background: #f9f9f9; }
</style>
</head>
<body>

<h1>Echo Form Demo</h1>
<p>Submit data to different language endpoints:</p>

<form id="echoForm" method="POST" action="cgi-bin/echo-php.php">
    <label>
        Language:
        <select id="language" name="language">
            <option value="cgi-bin/echo-php.php">PHP</option>
            <option value="cgi-bin/echo-perl.pl">Perl</option>
            <option value="cgi-bin/echo-node.js">NodeJS</option>
        </select>
    </label>

    <label>
        Method:
        <select id="method" name="method">
            <option value="GET">GET</option>
            <option value="POST" selected>POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
        </select>
    </label>

    <label>
        Encoding:
        <select id="encoding" name="encoding">
            <option value="application/x-www-form-urlencoded" selected>application/x-www-form-urlencoded</option>
            <option value="application/json">application/json</option>
        </select>
    </label>

    <label>
        Field 1: <input type="text" name="field1" required>
    </label>
    <label>
        Field 2: <input type="text" name="field2">
    </label>

    <button type="submit">Submit</button>
</form>

<div id="responseContainer">
    <em>Response will appear here if JavaScript is enabled.</em>
</div>

<!-- Vanilla JS to handle dynamic method/encoding and fetch -->
<script>
document.getElementById('echoForm').addEventListener('submit', function(e) {
    const method = document.getElementById('method').value;
    const encoding = document.getElementById('encoding').value;
    const url = document.getElementById('language').value; // dynamically choose endpoint

    // Only intercept if method is not GET or encoding is JSON
    if (method === 'GET' && encoding === 'application/x-www-form-urlencoded') return;

    e.preventDefault();

    // Collect form fields
    let data = {};
    this.querySelectorAll('input[name]').forEach(input => {
        data[input.name] = input.value;
    });

    let options = { method, headers: {} };

    if (encoding === 'application/json') {
        options.headers['Content-Type'] = 'application/json';
        options.body = JSON.stringify(data);
    } else {
        options.headers['Content-Type'] = 'application/x-www-form-urlencoded';
        options.body = new URLSearchParams(data);
    }

    fetch(url, options)
        .then(r => r.text())
        .then(html => {
            // Display response inside container
            document.getElementById('responseContainer').innerHTML = html;
        })
        .catch(err => {
            document.getElementById('responseContainer').innerHTML = "<p style='color:red;'>Error: " + err + "</p>";
            console.error(err);
        });
});
</script>

</body>
</html>


