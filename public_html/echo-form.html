<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Echo Form Demo</title>
<style>
    body { font-family: sans-serif; margin: 2em; }
    label { display: block; margin-top: 1em; }
</style>
</head>
<body>

<h1>Echo Form Demo (PHP Endpoint)</h1>

<!-- FORM -->
<form id="echoForm" method="POST" action="cgi-bin/echo-php.php">
    <label>HTTP Method:
        <select id="method" name="method">
            <option value="GET">GET</option>
            <option value="POST" selected>POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
        </select>
    </label>

    <label>Encoding:
        <select id="encoding" name="encoding">
            <option value="application/x-www-form-urlencoded" selected>x-www-form-urlencoded</option>
            <option value="application/json">application/json</option>
        </select>
    </label>

    <label>Field 1: <input type="text" name="field1" value="foo"></label>
    <label>Field 2: <input type="text" name="field2" value="bar"></label>

    <button type="submit">Send</button>
</form>

<!-- JS logic for advanced methods and JSON -->
<script>
document.getElementById('echoForm').addEventListener('submit', function(e) {
    const method = document.getElementById('method').value;
    const encoding = document.getElementById('encoding').value;
    const url = 'cgi-bin/echo-php.php'; // Correct relative path

    // Only intercept POST/PUT/DELETE or JSON
    if (method === 'GET' && encoding === 'application/x-www-form-urlencoded') {
        // Let browser handle normal GET form submit
        return;
    }

    e.preventDefault(); // prevent default form submission

    // Collect form fields
    let data = {};
    this.querySelectorAll('input[name]').forEach(input => {
        data[input.name] = input.value;
    });

    let options = { method, headers: {} };

    if (encoding === 'application/json') {
        options.headers['Content-Type'] = 'application/json';
        options.body = JSON.stringify(data);
    } else {
        options.headers['Content-Type'] = 'application/x-www-form-urlencoded';
        options.body = new URLSearchParams(data);
    }

    fetch(url, options)
        .then(r => r.text())
        .then(html => {
            // Replace current page with response
            document.open();
            document.write(html);
            document.close();
        })
        .catch(err => {
            alert("Error: " + err);
            console.error(err);
        });
});
</script>

<noscript>
<p><strong>Note:</strong> Without JavaScript, only GET and POST requests with form-urlencoded encoding will work.</p>
</noscript>

</body>
</html>
